{% extends "base.html" %}

{% block content %}
<div class="flex-1 flex flex-col min-h-0">
    <!-- Controls bar -->
    <div class="bg-surface-light border-b border-gray-700 px-6 py-3 flex items-center gap-4 flex-wrap shrink-0">
        <!-- Strategy tabs -->
        <div class="flex items-center gap-1" id="strategy-tabs">
            {% for s in strategies %}
            <button
                class="strategy-tab px-4 py-1.5 rounded text-sm transition-colors
                       {% if loop.first %}bg-accent text-white{% else %}bg-surface text-gray-400 hover:text-white hover:bg-surface-lighter{% endif %}"
                data-strategy="{{ s }}">
                {{ s | replace('_', ' ') | title }}
            </button>
            {% endfor %}
        </div>

        <div class="w-px h-6 bg-gray-700"></div>

        <!-- Instrument -->
        <select id="instrument-select" class="bg-surface border border-gray-700 rounded px-3 py-1.5 text-sm text-gray-200 focus:border-accent focus:outline-none">
            {% for inst in instruments %}
            <option value="{{ inst }}" {% if inst == default_instrument %}selected{% endif %}>{{ inst | replace('_', '/') }}</option>
            {% endfor %}
        </select>

        <!-- Interval -->
        <select id="interval-select" class="bg-surface border border-gray-700 rounded px-3 py-1.5 text-sm text-gray-200 focus:border-accent focus:outline-none">
            {% for iv in intervals %}
            <option value="{{ iv }}" {% if iv == default_interval %}selected{% endif %}>{{ iv }}</option>
            {% endfor %}
        </select>

        <!-- Date range -->
        <label class="text-gray-400 text-sm">From</label>
        <input id="from-date" type="date"
               class="bg-surface border border-gray-700 rounded px-3 py-1.5 text-sm text-gray-200 focus:border-accent focus:outline-none">
        <label class="text-gray-400 text-sm">To</label>
        <input id="to-date" type="date"
               class="bg-surface border border-gray-700 rounded px-3 py-1.5 text-sm text-gray-200 focus:border-accent focus:outline-none">

        <!-- Run button -->
        <button id="run-backtest" class="bg-accent hover:bg-red-600 text-white px-5 py-1.5 rounded text-sm font-semibold transition-colors">
            Run Backtest
        </button>

        <!-- Auto-refresh -->
        <div class="flex items-center gap-2">
            <select id="refresh-interval" class="bg-surface border border-gray-700 rounded px-3 py-1.5 text-sm text-gray-200 focus:border-accent focus:outline-none">
                <option value="1">1s</option>
                <option value="3" selected>3s</option>
                <option value="5">5s</option>
                <option value="10">10s</option>
            </select>
            <button id="auto-refresh-btn" class="bg-surface border border-gray-700 hover:border-accent text-gray-400 hover:text-white px-4 py-1.5 rounded text-sm font-semibold transition-colors">
                Auto Refresh
            </button>
        </div>

        <!-- Timezone session toggles -->
        <div class="w-px h-6 bg-gray-700"></div>
        <div class="flex items-center gap-1">
            <span class="text-gray-500 text-xs mr-1">Sessions:</span>
            <button id="tz-asia" class="tz-toggle px-3 py-1 rounded text-xs font-semibold transition-colors bg-surface border border-gray-700 text-gray-400 hover:text-white"
                    data-tz="asia" data-active-bg="rgba(255,200,50,0.25)" data-active-border="#ca8a04" data-active-text="#facc15">
                Asia
            </button>
            <button id="tz-london" class="tz-toggle px-3 py-1 rounded text-xs font-semibold transition-colors bg-surface border border-gray-700 text-gray-400 hover:text-white"
                    data-tz="london" data-active-bg="rgba(50,150,255,0.25)" data-active-border="#2563eb" data-active-text="#60a5fa">
                London
            </button>
            <button id="tz-eastern" class="tz-toggle px-3 py-1 rounded text-xs font-semibold transition-colors bg-surface border border-gray-700 text-gray-400 hover:text-white"
                    data-tz="eastern" data-active-bg="rgba(255,100,100,0.25)" data-active-border="#dc2626" data-active-text="#f87171">
                Eastern
            </button>
        </div>

        <!-- Parameters toggle -->
        <button id="toggle-params" class="text-gray-400 hover:text-white text-sm transition-colors ml-auto">
            Parameters &#9662;
        </button>
    </div>

    <!-- Collapsible parameters -->
    <div id="params-panel" class="hidden bg-surface-light border-b border-gray-700 px-6 py-3 shrink-0">
        <div id="params-container" class="flex flex-wrap gap-4 text-sm">
            <span class="text-gray-500 italic">Select a strategy to see parameters</span>
        </div>
    </div>

    <!-- Chart -->
    {% include "components/chart.html" %}

    <!-- Metrics -->
    {% include "components/metrics.html" %}
</div>
{% endblock %}
